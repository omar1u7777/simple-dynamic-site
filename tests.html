<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Enhetstester</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .pass { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .fail { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .summary { font-weight: bold; margin-top: 20px; padding: 15px; border-radius: 4px; }
    .summary.pass { background: #d4edda; color: #155724; }
    .summary.fail { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>
  <h1>Enhetstester för Webbplatsen</h1>
  <div id="test-results"></div>
  <div id="test-summary" class="summary"></div>

  <script src="js/api.js"></script>
  <script>
    // Enkel test-runner
    class TestRunner {
      constructor() {
        this.results = []
        this.passed = 0
        this.failed = 0
      }

      assert(condition, message) {
        if (condition) {
          this.passed++
          this.results.push({ status: 'pass', message: message })
        } else {
          this.failed++
          this.results.push({ status: 'fail', message: message })
        }
        this.updateUI()
      }

      async assertAsync(promise, message) {
        try {
          const result = await promise
          this.assert(result, message)
        } catch (error) {
          this.assert(false, message + ' - Error: ' + error.message)
        }
      }

      updateUI() {
        const resultsDiv = document.getElementById('test-results')
        const summaryDiv = document.getElementById('test-summary')

        resultsDiv.innerHTML = this.results.map(result =>
          `<div class="test-result ${result.status}">${result.status.toUpperCase()}: ${result.message}</div>`
        ).join('')

        const total = this.passed + this.failed
        const summaryClass = this.failed === 0 ? 'pass' : 'fail'
        summaryDiv.className = `summary ${summaryClass}`
        summaryDiv.textContent = `Total: ${total} tester, ${this.passed} godkända, ${this.failed} misslyckade`
      }
    }

    // Test functions
    async function runTests() {
      const runner = new TestRunner()

      // Test API functions
      console.log('Testing API functions...')

      // Test fetchPosts
      await runner.assertAsync(
        API.fetchPosts(1, 0).then(data => Array.isArray(data.posts) && data.posts.length > 0),
        'API.fetchPosts should return posts array'
      )

      // Test fetchAllUsers
      await runner.assertAsync(
        API.fetchAllUsers().then(users => Array.isArray(users) && users.length > 0),
        'API.fetchAllUsers should return users array'
      )

      // Test fetchAllComments
      await runner.assertAsync(
        API.fetchAllComments().then(comments => Array.isArray(comments) && comments.length > 0),
        'API.fetchAllComments should return comments array'
      )

      // Test utility functions (mock implementations for testing)
      console.log('Testing utility functions...')

      // Test escapeHtml
      function escapeHtml(text) {
        if (text === undefined || text === null) return ''
        var s = String(text)
        s = s.replace(/&/g, '&')
        s = s.replace(/</g, '<')
        s = s.replace(/>/g, '>')
        s = s.replace(/"/g, '"')
        s = s.replace(/'/g, '&#039;')
        return s
      }

      runner.assert(escapeHtml('<script>') === '<script>', 'escapeHtml should escape HTML characters')
      runner.assert(escapeHtml('normal text') === 'normal text', 'escapeHtml should not change safe text')
      runner.assert(escapeHtml(null) === '', 'escapeHtml should handle null values')

      // Test localStorage availability
      runner.assert(typeof Storage !== 'undefined', 'localStorage should be available')

      // Test DOM elements exist
      runner.assert(document.getElementById('test-results') !== null, 'Test results container should exist')
      runner.assert(document.getElementById('test-summary') !== null, 'Test summary container should exist')

      console.log('All tests completed!')
    }

    // Run tests when page loads
    window.addEventListener('load', runTests)
  </script>
</body>
</html>